import org.apache.hc.client5.http.classic.methods.HttpPost;
import org.apache.hc.client5.http.entity.StringEntity;
import org.apache.hc.client5.http.impl.classic.CloseableHttpClient;
import org.apache.hc.client5.http.impl.classic.CloseableHttpResponse;
import org.apache.hc.client5.http.impl.classic.HttpClients;
import org.apache.hc.core5.ssl.SSLContextBuilder;
import org.apache.hc.core5.http.io.entity.EntityUtils;
import org.apache.hc.core5.ssl.SSLContexts;

import javax.net.ssl.SSLContext;
import java.io.File;

public class SoapPostWithJKS {

    public static void main(String[] args) throws Exception {
        String jksPath = "ruta/cliente.jks";
        String jksPassword = "tu_password";

        // SOAP body en XML (ajústalo según tu operación)
        String soapBody =
                "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n" +
                "<soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:ej=\"http://ejemplo.com/\">\n" +
                "   <soapenv:Header/>\n" +
                "   <soapenv:Body>\n" +
                "      <ej:miOperacion>\n" +
                "         <ej:parametro>valor</ej:parametro>\n" +
                "      </ej:miOperacion>\n" +
                "   </soapenv:Body>\n" +
                "</soapenv:Envelope>";

        // Crear SSLContext con el JKS
        SSLContext sslContext = SSLContextBuilder.create()
                .loadKeyMaterial(new File(jksPath), jksPassword.toCharArray(), jksPassword.toCharArray())
                .build();

        try (CloseableHttpClient httpClient = HttpClients.custom()
                .setSSLContext(sslContext)
                .build()) {

            HttpPost post = new HttpPost("https://tuservicio.com/soapendpoint");

            // Encabezados SOAP
            post.setHeader("Content-Type", "text/xml;charset=UTF-8");
            post.setHeader("SOAPAction", "http://ejemplo.com/AccionSoap");

            // Cuerpo de la petición
            post.setEntity(new StringEntity(soapBody));

            // Ejecutar la solicitud
            try (CloseableHttpResponse response = httpClient.execute(post)) {
                System.out.println("Código HTTP: " + response.getCode());
                String responseBody = EntityUtils.toString(response.getEntity());
                System.out.println("Respuesta SOAP: \n" + responseBody);
            }
        }
    }
}
